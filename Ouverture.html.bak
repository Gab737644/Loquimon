<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <title>Ouverture du paquet - Loquimon</title>
    <style>
        body { margin: 0; background: linear-gradient(120deg, #FFE259, #FFA751); color: white; font-family: Arial, sans-serif; text-align: center; min-height: 100vh; }
        h1 { margin-top: 20px; }
        #loquicoins { position: fixed; top: 12px; left: 12px; display: flex; align-items: center; gap: 8px; font-weight: bold; font-size: 30px; z-index: 1000; }
        #loquicoins img { width: 65px; height: 65px; }
        #paquet { width: 200px; height: 280px; margin: 80px auto; cursor: pointer; transition: transform 0.2s; }
        #paquet img { width: 100%; height: 100%; object-fit: contain; }
        .openAnim { animation: crackOpen 1.1s forwards; pointer-events: none; }
        @keyframes crackOpen { 0% { transform: scale(1); } 50% { transform: rotate(10deg) scale(1.2); } 100% { transform: scale(1.5); opacity: 0; } }

        #zoneCartes { display: flex; justify-content: center; gap: 30px; margin-top: 40px; flex-wrap: wrap; padding: 20px; }
        .carte { width: 160px; height: 260px; border: 4px solid #555; border-radius: 16px; background: #1b1b1b; overflow: hidden; cursor: pointer; animation: flip 0.6s ease-out; position: relative; }
        .carte img { width: 100%; height: 100%; object-fit: cover; }
        
        /* Styles des raretés */
        .diamant { border-color: #00c6ff; box-shadow: 0 0 25px #00c6ff; }
        .unreal { 
            background: transparent !important; 
            border: 5px solid;
            border-image: linear-gradient(45deg, red, yellow, lime, cyan, blue, magenta, red) 1;
            animation: rainbowBorder 2s linear infinite, flip 0.6s ease-out;
            box-shadow: 0 0 40px rgba(255,255,255,0.8);
        }
        @keyframes rainbowBorder { 0% { filter: hue-rotate(0deg); } 100% { filter: hue-rotate(360deg); } }

        #overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.85); justify-content: center; align-items: center; z-index: 2000; }
        #zoomCarte { width: 300px; height: 500px; border: 5px solid #fff; border-radius: 20px; overflow: hidden; }
        #zoomCarte img { width: 100%; height: 100%; object-fit: cover; }
        #btnRetour { position: absolute; top: 20px; right: 20px; padding: 10px 20px; background: #1b1b1b; color: white; border: 2px solid #666; border-radius: 10px; cursor: pointer; font-weight: bold; }
    </style>
  </head>
  <body>
    <div id="loquicoins"> 
        <img src="images/loquicoin.png" alt="Loquicoins">
        <span id="coinCount">0</span> 
    </div>

    <button id="btnRetour" onclick="window.location.href='index.html'">RETOUR</button>
    
    <h1>Ouverture du paquet</h1>
    <p id="instruction">Clique sur le paquet pour l'ouvrir !</p>
    
    <div id="paquet" onclick="ouvrir()"> 
        <img src="images/paquet.png"> 
    </div>

    <div id="zoneCartes"></div>

    <div id="overlay" onclick="fermerZoom()">
      <div id="zoomCarte"><img id="zoomImg"></div>
    </div>

    <script>
        // Sécurité anti-refresh
        if (performance.getEntriesByType("navigation")[0].type === "reload") {
            window.location.href = "index.html";
        }

        const imagesBronze = ["images/cafard.png","images/mouche.png","images/moustique.png","images/pigeon.png","images/rat.png","images/escargot.png","images/ver de terre.png","images/taupe.png", "images/bousier.png", "images/abeille.png"];
        const imagesArgent = ["images/chat.png","images/cheval.png","images/chien.png","images/poisson.png","images/tortue.png","images/cochon d'inde.png","images/perruche.png","images/écureuil.png", "images/cochon.png", "images/coq.png", "images/lapin.png", "images/vache.png", "images/serpent.png"];
        const imagesOr = ["images/aigle.png","images/baleine.png","images/cerf.png","images/Elephant.png","images/tigre.png","images/lion.png","images/loup.png", "images/girafe.png", "images/rhinoceros.png", "images/pingouin.png"];
        const imagesPlatine = ["images/addax.png","images/axolotl.png","images/lynx.png","images/macareux.png","images/panthère.png","images/requin.png", "images/pery.png", "images/panda.png"];
        const imagesDiamant = ["images/kraken.png","images/Dragon.png","images/licorne.png","images/phénix.png","images/yeti.png"];
        const imagesUnreal = ["images/Jésus.png"];

        const COIN_VALUES = { bronze: 1, argent: 3, or: 8, platine: 20, diamant: 50, unreal: 500 };
        let isOpening = false;

        window.onload = () => { 
            document.getElementById("coinCount").innerText = localStorage.getItem("loquicoins") || 0;
        };

        function tirerRarete() {
            let r = Math.random() * 100;
            let typePack = sessionStorage.getItem("typePack") || "gratuit";

            if (typePack === "mega") {
                // --- TAUX BOOSTÉS (PACK 50 GEMMES) ---
                if (r < 0.05) return {liste: imagesUnreal, type: "unreal"}; 
                if (r < 4)    return {liste: imagesDiamant, type: "diamant"}; 
                if (r < 25)   return {liste: imagesPlatine, type: "platine"};
                if (r < 64)   return {liste: imagesOr, type: "or"};          
                if (r < 90)   return {liste: imagesArgent, type: "argent"};  
                return {liste: imagesBronze, type: "bronze"};                
            } else {
                // --- TAUX NORMAUX (PACK GRATUIT) ---
                if (r < 0.05) return {liste: imagesUnreal, type: "unreal"};
                if (r < 0.5)  return {liste: imagesDiamant, type: "diamant"};
                if (r < 2.5)  return {liste: imagesPlatine, type: "platine"};
                if (r < 14.5) return {liste: imagesOr, type: "or"};
                if (r < 44.5) return {liste: imagesArgent, type: "argent"};
                return {liste: imagesBronze, type: "bronze"};
            }
        }

        function ouvrir() {
            if (isOpening) return;
            isOpening = true;
            const p = document.getElementById("paquet");
            p.classList.add("openAnim");
            document.getElementById("instruction").innerText = "Ouverture...";
            setTimeout(() => {
                p.style.display = "none";
                genererCartes();
            }, 1100);
        }

        function genererCartes() {
            const zone = document.getElementById("zoneCartes");
            let coins = parseInt(localStorage.getItem("loquicoins")) || 0;
            let coll = JSON.parse(localStorage.getItem("collection")) || {};

            for (let i = 0; i < 3; i++) {
                const tirage = tirerRarete();
                const imgSrc = tirage.liste[Math.floor(Math.random() * tirage.liste.length)];
                coins += COIN_VALUES[tirage.type];
                
                let nom = imgSrc.split("/").pop().split(".")[0];
                coll[nom] = (coll[nom] || 0) + 1;    

                const cardDiv = document.createElement("div");
                cardDiv.className = "carte " + tirage.type;
                const img = document.createElement("img");
                img.src = imgSrc;
                img.onerror = function() { this.src = "https://via.placeholder.com/160x260?text=Erreur"; };
                
                cardDiv.appendChild(img);
                cardDiv.onclick = () => zoom(imgSrc);
                zone.appendChild(cardDiv);
            }

            // Sauvegarde et nettoyage
            localStorage.setItem("loquicoins", coins);
            localStorage.setItem("collection", JSON.stringify(coll));
            sessionStorage.removeItem("typePack"); // On réinitialise pour le prochain tour
            
            document.getElementById("coinCount").innerText = coins;
            document.getElementById("instruction").innerText = "Félicitations !";
        }

        function zoom(s) {
            document.getElementById("zoomImg").src = s;
            document.getElementById("overlay").style.display = "flex";
        }
        function fermerZoom() { document.getElementById("overlay").style.display = "none"; }
    </script>
  </body>
</html>